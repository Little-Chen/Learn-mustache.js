{"version":3,"file":"vue.js","sources":["../../src/scanner.js","../../src/nestTokens.js","../../src/parseTemplateToTokens.js","../../src/lookup.js","../../src/parseArray.js","../../src/renderTemplate.js","../../src/index.js"],"sourcesContent":["/**\r\n * 扫描器类\r\n */\r\n\r\n// export default class Scanner  {\r\n//     constructor(templateStr, data){\r\n//         this.templateStr = templateStr\r\n//         this.pos = 0\r\n//         this.tail = this.templateStr.substr(this.pos)\r\n//     }\r\n\r\n//     // 指针扫描字符串，知道遇见目标内容结束，并记录扫描过的内容\r\n//     scanUtil (tag) {\r\n//         const pos_backup = this.pos\r\n//         var str = this.tail\r\n//         while(!this.eos() && this.tail.indexOf(tag) != 0){\r\n//             this.pos++\r\n//             this.tail = this.templateStr.substr(this.pos)\r\n//         }\r\n\r\n//         return this.templateStr.substring(pos_backup, this.pos)\r\n//     }\r\n//     // 跳过目标关键字，准备开启下一轮扫描\r\n//     scan (tag) {\r\n//         if(this.tail.indexOf(tag) === 0){\r\n//             this.pos += tag.length\r\n//             this.tail = this.templateStr.substr(this.pos)\r\n//         }\r\n//     }\r\n//     // 指针是否走到结尾\r\n//     eos () {\r\n//         return this.pos >= this.templateStr.length\r\n//     } \r\n// }\r\n\r\n\r\nexport default class Scanner {\r\n    constructor (templateStr, data) {\r\n        this.templateStr = templateStr\r\n        this.data = data\r\n        this.pos = 0 // 初始化指针\r\n        this.tail = this.templateStr.substr(this.pos) // 初始化尾巴字符串\r\n    }   \r\n\r\n    // 扫描标识符，并记录走过内容\r\n    scanUtil(stopTag){\r\n        var pos_backup = this.pos\r\n        while(!this.eos() && this.tail.indexOf(stopTag) !== 0){\r\n            this.pos++\r\n            this.tail = this.templateStr.substr(this.pos)\r\n        }\r\n        return this.templateStr.substring(pos_backup, this.pos)\r\n    }\r\n\r\n    // 跳过标识符\r\n    scan(tag){\r\n        if(this.tail.indexOf(tag) === 0){\r\n            var pos_backup = this.pos\r\n            this.pos +=  tag.length\r\n            this.tail =  this.templateStr.substr(this.pos)\r\n            return this.templateStr.substring(pos_backup, this.pos)\r\n        }\r\n    }\r\n\r\n    // 查询中止条件\r\n    eos () {\r\n        return this.pos >= this.templateStr.length\r\n    }\r\n}","export default function NestTokens (tokens) {\r\n\r\n    var sections = [] // 作为栈队，记录每层标识符的出入\r\n    var nestTokens,collector;\r\n    nestTokens = collector = [] // 收集每层的内容，并将改变同步到nestTOkens中\r\n\r\n    for (let i = 0; i < tokens.length; i++) {\r\n        const token = tokens[i];\r\n        switch(token[0]) {\r\n            case '#':\r\n                collector.push(token)\r\n                sections.push(token)\r\n                collector = token[2] = []\r\n                break;\r\n            case '/':\r\n                sections.pop()\r\n                collector = sections.length > 0 ? sections[sections.length -1][2] : nestTokens;\r\n                break;\r\n\r\n            default:\r\n                collector.push(token)\r\n        }\r\n    }\r\n    \r\n    return nestTokens\r\n}","import Scanner from './scanner'\r\nimport NestTokens from './nestTokens';\r\n\r\nexport default function ParseTemplateToTokens (templateStr) {\r\n    var tokens = []\r\n\r\n    // 创建扫描器\r\n\r\n    var scanner = new Scanner (templateStr)\r\n    var words;\r\n    // 扫描工作\r\n    while(!scanner.eos()){\r\n        // 收集开始标签前的内容\r\n        words = scanner.scanUtil('{{').replace(/\\s/g, '') // todo 合理去除空格\r\n        words ? tokens.push(['text', words]) : ''\r\n        scanner.scan(\"{{\")\r\n        // 收集结束标签前的内容\r\n        words = scanner.scanUtil('}}')\r\n        if(words[0] == '#'){\r\n            words ? tokens.push(['#', words.substring(1)]) : ''\r\n        } else if(words[0] == '/'){\r\n            words ? tokens.push(['/',  words.substring(1)]) : ''\r\n        } else {\r\n            words ? tokens.push(['name', words]) : ''\r\n        }\r\n        \r\n        scanner.scan(\"}}\")\r\n    }\r\n    return NestTokens(tokens)\r\n}","/**\r\n * 递归找到数据源中对应属性值\r\n * @param {数据对象} dataObj \r\n * @param {变量名} keyName \r\n * @returns \r\n */\r\nexport default function lookup (dataObj, keyName) {\r\n\r\n    if(keyName.indexOf('.') != -1 && keyName != '.'){\r\n        // 将.获取属性转化为数组\r\n        var keys = keyName.split('.')\r\n        var temp = dataObj\r\n        // 设置一个临时变量，剥洋葱法获取最终值\r\n        for (let i = 0; i < keys.length; i++) {\r\n            const key = keys[i];\r\n            temp = temp[key] // 一层层获取值，存入临时变量中\r\n        }\r\n        return temp\r\n    }else{\r\n        return dataObj[keyName]\r\n    }\r\n}","import renderTemplate from \"./renderTemplate\";\r\n\r\n/**\r\n * 遍历渲染数组类型的模板片段，拼接到模板字符串中\r\n * 渲染仍交由renderTemplate完成，此处存在互相调用\r\n * @param {数组对应tokens} tokenArr \r\n * @param {数组对应数据源} dataObj \r\n * @returns \r\n */\r\nexport default function parseArray (tokenArr, dataObj) {\r\n    var resStr = ''\r\n    console.log(tokenArr, dataObj);\r\n    if(Array.isArray(tokenArr)){\r\n        // 遍历的次数，此时应该由数据源数组的项数决定\r\n        for (let i = 0; i < dataObj.length; i++) {\r\n            const data = dataObj[i];\r\n            // 支持{{.}}渲染数组简单项，需在对象上扩展一个'.'属性，值等于本身\r\n            resStr += renderTemplate(tokenArr, {\r\n                ...data,\r\n                '.': data\r\n            })\r\n        }\r\n    }\r\n    return resStr\r\n}","import lookup from \"./lookup\";\r\nimport parseArray from \"./parseArray\";\r\n\r\nexport default function renderTemplate (tokens, data) {\r\n    var resStr = ''\r\n    for (let i = 0; i < tokens.length; i++) {\r\n        const token = tokens[i];\r\n        \r\n        if(token[0] == 'text'){\r\n            // 普通文本或HTML标签，拼接字符串模板即可\r\n            resStr += token[1]\r\n        } else if(token[0] == 'name') {\r\n            // 变量类型，替换对应数据渲染模板\r\n            resStr += lookup(data, token[1])\r\n        } else if(token[0] == '#') {\r\n            // 数组类型，需要遍历解析数组，递归渲染模板\r\n            var keyName = token[1]\r\n            var dataObj = lookup(data, keyName)\r\n            resStr += parseArray(token[2], dataObj)\r\n        }\r\n    }\r\n\r\n    return resStr\r\n}","// function Vue(options){\r\n//     console.log(options)\r\n//     console.log(2)\r\n// }\r\n\r\n// export default Vue\r\n\r\nimport ParseTemplateToTokens from \"./parseTemplateToTokens\"\r\nimport renderTemplate from \"./renderTemplate\";\r\n// import lookup from \"./lookup\"\r\n\r\nvar word = ''\r\n\r\nconst Mustache = {\r\n\trender (templateStr, data) {\r\n\t\t// 将模板处理成tokens\r\n\t\tvar tokens = new ParseTemplateToTokens(templateStr)\r\n\t\tconsole.log(tokens);\r\n\r\n\t\t// 将tokens结合数据，转化为真实html字符串\r\n\t\tvar resStr = renderTemplate(tokens, data)\r\n\r\n\t\treturn resStr\r\n\r\n\t\t// var scanner = new Scanner(templateStr, data) \r\n\t\t// while(!scanner.eos()){\r\n\t\t// \tword = scanner.scanUtil('{{')\r\n\t\t// \tconsole.log(word);\r\n\t\t// \tscanner.scan('{{')\r\n\t\t// \tword = scanner.scanUtil('}}')\r\n\t\t// \tconsole.log(word);\r\n\t\t// \tscanner.scan('}}')  \r\n\t\t// }\r\n\r\n\r\n\t\t// var res = lookup({\r\n\t\t// \ta: {\r\n\t\t// \t\tb: {\r\n\t\t// \t\t\tc: 100\r\n\t\t// \t\t}\r\n\t\t// \t}\r\n\t\t// }, 'a.b.c')\r\n\t\t// console.log(res);\r\n\t}\r\n}\r\n\r\nexport default Mustache"],"names":["Scanner","constructor","templateStr","data","pos","tail","substr","scanUtil","stopTag","pos_backup","eos","indexOf","substring","scan","tag","length","NestTokens","tokens","sections","nestTokens","collector","i","token","push","pop","ParseTemplateToTokens","scanner","words","replace","lookup","dataObj","keyName","keys","split","temp","key","parseArray","tokenArr","resStr","console","log","Array","isArray","renderTemplate","Mustache","render"],"mappings":"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"}